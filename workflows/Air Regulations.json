{"createdAt":"2025-09-25T21:59:12.175Z","updatedAt":"2025-09-29T13:31:27.000Z","id":"5oMazOkChTKtE0hk","name":"Air Regulations","active":true,"isArchived":false,"nodes":[{"parameters":{"triggerOn":"folder","path":"/data/windows_shared/Regulations/English","events":["add","change","unlink","addDir","unlinkDir"],"options":{"followSymlinks":true,"ignoreInitial":false,"depth":-1}},"type":"n8n-nodes-base.localFileTrigger","typeVersion":1,"position":[-336,224],"id":"cdf422ec-be7a-43ed-b1db-33c53cf6df20","name":"Local File Trigger","disabled":true},{"parameters":{"fileSelector":"/data/windows_shared/Regulations/English/*","options":{"dataPropertyName":"data"}},"type":"n8n-nodes-base.readWriteFile","typeVersion":1,"position":[0,224],"id":"3eace7e2-6c57-4673-94f5-39bd854d286c","name":"Read/Write Files from Disk","alwaysOutputData":false,"disabled":true},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents_regulations","mode":"list","cachedResultName":"documents_regulations"},"embeddingBatchSize":50,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1440,224],"id":"b65fdc8a-7a16-4330-899b-2e4985674ade","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"bQMqD3zM78NA1YFW","name":"Supabase account"}}},{"parameters":{"textSplittingMode":"custom","options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[1568,448],"id":"79b0f8ae-87c2-4d98-9f79-7dffa2b275cf","name":"Default Data Loader"},{"parameters":{"chunkOverlap":200,"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[1760,624],"id":"193d2d6d-8501-448f-ae1c-7e00111caa66","name":"Recursive Character Text Splitter"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[320,224],"id":"08a10105-e3b8-4a4c-b6f1-5915614fe107","name":"Extract from File"},{"parameters":{"assignments":{"assignments":[{"id":"0b7d086b-2474-4ffe-bbaa-28eb3be49d11","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[736,224],"id":"08644424-7b05-44d3-8697-927050b2cced","name":"Edit Fields","alwaysOutputData":true},{"parameters":{"public":true,"initialMessages":"Hi there! 👋\nMy name is Sami. How can I assist you today?","options":{"allowFileUploads":true}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-416,640],"id":"70419b3c-1d36-4b45-8c84-a2306b74cbd7","name":"When chat message received","webhookId":"5b36dad5-3c8c-4cf2-b42a-b9d7523036da"},{"parameters":{"options":{"systemMessage":"You are a helpful assistant.\n\nYou MUST use the Hybrid_search_tool tool to find the answer. Do not use your own knowledge.\n\nIf you are not sure what to say, then simply output \"Sorry, I don't know\""}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[0,640],"id":"f58ebc58-c35e-4c8d-929e-ada8228333c7","name":"AI Agent","alwaysOutputData":true,"notesInFlow":false},{"parameters":{"assignments":{"assignments":[{"id":"ac913869-daeb-4727-9c97-4546742acf63","name":"text","value":"={{ $json.text\n  .replace(/<[^>]*>/gu, ' ')                                       // remove HTML tags\n  .replace(/[^\\p{L}\\p{N}\\s\\n•\\-*()\\[\\]{}<>.,،'\"«»“”‘’]/gu, ' ')    // keep allowed chars\n  .replace(/([^\\p{N}])(\\p{N})/gu, '$1 $2')                         // add space between letter -> number\n  .replace(/[ \\t]+/gu, ' ')                                        // collapse multiple spaces/tabs\n  .replace(/\\n{3,}/g, '\\n\\n')                                      // collapse 3+ newlines to 2\n  .replace(/[ \\t]*([•\\-*])\\s*/g, '\\n$1 ')                          // ensure bullets start on a new line\n  .replace(/ +\\./g, '.')                                           // remove spaces before dot\n  .replace(/([،.])([^\\s])/g, '$1 $2')                              // ensure space after comma or dot\n  .trim()\n}}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[944,224],"id":"7ab251aa-c75e-40ff-837d-d8d252d10984","name":"Edit Fields1"},{"parameters":{"formTitle":"Archivo","formFields":{"values":[{"fieldLabel":"File","fieldType":"file","multipleFiles":false,"acceptFileTypes":".pdf","requiredField":true}]},"options":{}},"id":"3885b082-fbf9-427b-bbe8-12c0ea75da79","name":"On form submission","type":"n8n-nodes-base.formTrigger","position":[0,0],"webhookId":"fb1e30f9-908e-4240-9809-74db9c51100d","typeVersion":2.2},{"parameters":{"contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[96,912],"id":"8eaa9eb2-d28c-4859-80fc-9905f2deace4","name":"Simple Memory"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-112,880],"id":"f1d4338a-ff6b-432e-a47a-981e17c8f286","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"ybKWjgaznJsUQAHd","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1392,448],"id":"fa6e2b28-89e7-46f0-b329-4fe20ee4b908","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"ybKWjgaznJsUQAHd","name":"OpenAi account"}}},{"parameters":{"method":"POST","url":"https://ohbglkhpupqvctupgmjw.supabase.co/functions/v1/hybrid_search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9oYmdsa2hwdXBxdmN0dXBnbWp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDg1MzIsImV4cCI6MjA3MzQyNDUzMn0.WUYqkBTBNZuquDrKEgrJRrbiLZQl0KMP8d_aK9rcQq0"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"query","value":"={{ $json.chatInput }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[448,800],"id":"96d8611f-78f2-4f0a-980a-c44a6502a135","name":"HTTP Request1"},{"parameters":{"method":"POST","url":"https://ohbglkhpupqvctupgmjw.supabase.co/functions/v1/hybrid_search_Regulations","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9oYmdsa2hwdXBxdmN0dXBnbWp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDg1MzIsImV4cCI6MjA3MzQyNDUzMn0.WUYqkBTBNZuquDrKEgrJRrbiLZQl0KMP8d_aK9rcQq0"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"query","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[272,896],"id":"79c11f18-405a-4d4d-96ed-c2b2e329338f","name":"Hybrid_search_tool"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"text"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1152,224],"id":"92b1e6bf-ff96-435b-a483-a18e44d753fb","name":"Aggregate"},{"parameters":{"options":{}},"type":"n8n-nodes-tesseractjs.tesseractNode","typeVersion":1,"position":[528,224],"id":"783d8b2e-a981-4bdc-93cf-91afda2c11c5","name":"Tesseract"}],"connections":{"Local File Trigger":{"main":[[{"node":"Read/Write Files from Disk","type":"main","index":0}]]},"Read/Write Files from Disk":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Extract from File":{"main":[[{"node":"Tesseract","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Hybrid_search_tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Aggregate":{"main":[[{"node":"Supabase Vector Store","type":"main","index":0}]]},"Tesseract":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"0ec1a59a-d139-4c3b-a0c0-44575aef3ad6","triggerCount":2,"shared":[{"createdAt":"2025-09-25T21:59:12.181Z","updatedAt":"2025-09-25T21:59:12.181Z","role":"workflow:owner","workflowId":"5oMazOkChTKtE0hk","projectId":"LHEmgw1As9k75i72"}],"tags":[]}